---
title: 服务器拯救记
date: 2023-08-17 07:38:45
tags: [折腾]
published: true
hideInList: false
isTop: false
feature: https://img.010316.xyz/usr/uploads/2018/11/3561671962.jpg
---
2023年8月11日，周一。
这是一个值得悲伤的日子，
早上一上班就发现电脑处于宕机状态，经过一系列折腾，得出结论是系统盘坏了。每次重启开机都无法读取到系统盘。其中这一个小时的折腾中，有一次正常开启来，让我天真的以为之前开不了机是意外，现在恢复正常了。所以开了机以后就开始工作，谁曾想干了不到10分钟，直接显示系统异常，然后重启了。
再然后就一直读取不到了，联系了修电脑的说是固态硬盘坏了，需要更换。这样一搞，好多资料都没了。虽然大部分数据都用OneDrive备份了，但是一些软件的数据都没了，到现在我都不记得没了些啥，其中包括FinalShell中保存的服务器登录信息。其实是想登录服务器吧memos更新一下，这家伙版本更新太快了。国内的服务器还好，可以直接修改密码。但是又两台甲骨文的服务器，之前一直是用私钥登录的。
### 诱因
不过还好，找了半天，在D盘找到登录的私钥了，但是呢，因为这件事让我有了把服务器改成用账号密码登录的想法，之前一直想搞，但是搁浅了。今天这一搞，却搞出事了。
### 后果
再百度了几篇# 甲骨文免费云服务器改用账号密码登录ssh的文章后了，按照步骤开始搞，其实玩服务器也两三年了，也有一些浅显的认知，按道理讲，改成密码登录应该是没有难度的。到最后的结果就是搞完以后，发现登录不了了，不论是用私钥还是密码，都无法登录。
怎么办？怎么办？怎么办？
我脑子里一片问号，当时想着最不济也就是搞不成无法密码登录，谁能想到搞到最后直接服务器登不上去了。
一番查阅之后，发现是ssh端口关闭了。这就遇到个难题，想开启端口必须先登录进去操作，但是想登录进去必须是端口22开启状态。
### 解决办法
我在想通过其他端口能不能登录，在通过百度查找，再实践后发现行不通。
怎么办？怎么办？怎么办？
还是处于懵逼状态，这种情况少有人能遇到。
索性不管他了，下午重新复盘了一下，当时操作的时候基本上都没问题，唯一可能有问题的地方就是进入vim /etc/ssh/sshd_config 添加   PermitRootLogin yes #允许root登录 PasswordAuthentication yes #开启密码登录  这一步。
所以我就在想，如何能把这个文件恢复到修改之前的样子。
其实当时都有想法重置服务器了，还好，最后脑洞大开想到办法了。
因为除了端口22关闭以为，其它好多端口还开着呢，所以我可以正常登录宝塔面板，登录上去以后打开sshd_config这个文件，看了一遍也没发现不对的地方，当时也搞不懂了，想着死马当活马医，把另一台服务器的文件复制粘贴到这里，然后重启服务器，发现还是不行。
难道真的要重置服务器了吗？
我试着再查找，看到底是哪里出了问题，知道看见这篇文章，[Linux修改SSH默认22端口](https://blog.csdn.net/weixin_42170236/article/details/121976934)，
![[Pasted image 20230817152722.png]]我试着把22前面的＃去掉后，发现端口竟然开启了。
这一点没搞明白，另一台服务器中这个地方也是有#的，但是可以正常登录，这台服务器在今天折腾之前肯定也是有#的，到现在也没搞懂错在哪里。
### 结果
搞不懂就不搞了，一个学土木的搞懂这些干啥，能不重置登录就行了。
### 总结
1. 电脑要长备份，数据无价，一但丢失会很麻烦。
2. 服务器少折腾，工作重要，折腾太浪费时间，有时间不如多看看书。
3. 尽快把手里的数据整理归档，现在太散了，到处都是，找起来很不方便，而且少了些啥也不知道。
4. 尽快把从hexo换到hugo，用上木木老师的主题，太香了。